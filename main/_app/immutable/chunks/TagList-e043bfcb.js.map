{"version":3,"file":"TagList-e043bfcb.js","sources":["../../../../../../src/lib/components/utils/TagList.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { GetTagsDocument } from '$lib/generated/graphql';\n  import type { Tag } from '$lib/generated/graphql';\n  import Chip, { Set, Text } from '@smui/chips';\n  import MenuSurface from '@smui/menu-surface';\n  import { operationStore, query } from '@urql/svelte';\n  import type { MenuSurfaceComponentDev } from '@smui/menu-surface/src/MenuSurface.types';\n  import Textfield, { Input } from '@smui/textfield';\n  import FloatingLabel from '@smui/floating-label';\n  import type { InputComponentDev } from '@smui/textfield';\n\n  const getAllTags = operationStore(GetTagsDocument);\n\n  export let tags: Tag[] = [];\n  export let editable = false;\n\n  let inputA: InputComponentDev;\n\n  const shake = false;\n\n  let allTags: Tag[] = [];\n  let filteredTagsMatched: Tag[] = [];\n  let filteredTagsUnmatched: Tag[] = [];\n\n  let newTagText = '';\n\n  let newTag: HTMLInputElement;\n  let newTagContainer: HTMLElement = null;\n  let surface: MenuSurfaceComponentDev;\n\n  let focused = false;\n\n  $: newTag = inputA?.getElement();\n\n  function filterAvailableTags(tagList: Tag[], currentTags: Tag[], filterText: string): [Tag[], Tag[]] {\n    if (!tagList || !currentTags || !filterText) {\n      return [tagList, []];\n    }\n    console.log(filterText);\n    filterText = filterText.toLowerCase();\n    let unfiltered = tagList.filter((tag) => !currentTags.find((t) => t.id == tag.id));\n    const filtered = unfiltered.filter((tag) => !newTag || tag.name.toLowerCase().includes(filterText));\n    unfiltered = unfiltered.filter((tag) => filtered.findIndex((t) => t.id === tag.id) === -1);\n    return [filtered, unfiltered];\n  }\n\n  function updateTags() {\n    tags = tags;\n    [filteredTagsMatched, filteredTagsUnmatched] = filterAvailableTags(allTags, tags, newTagText);\n  }\n\n  if (editable) {\n    query(getAllTags);\n    getAllTags.subscribe(() => {\n      if (!getAllTags.fetching && !getAllTags.error) {\n        allTags = getAllTags.data.getTags;\n        updateTags();\n      }\n    });\n  }\n\n  function addTag(newTagObj: string | Tag) {\n    if (!allTags) {\n      return false;\n    }\n    const tagToAdd = allTags.find((tag) => {\n      if (typeof newTagObj == 'string') {\n        return newTagObj == tag.name || newTagObj == tag.id;\n      } else {\n        return newTagObj.id == tag.id;\n      }\n    }) as Tag;\n    if (tagToAdd && !tags.find((tag) => tag.id == tagToAdd.id)) {\n      tags.push(tagToAdd);\n      updateTags();\n      return true;\n    }\n    updateTags();\n    return false;\n  }\n\n  function deleteTag(tag: Tag) {\n    tags = tags.filter((v) => v != tag);\n    updateTags();\n  }\n\n  function onFocusLost() {\n    setTimeout(() => {\n      if (newTagContainer && !newTagContainer.contains(document.activeElement)) {\n        surface.setOpen(false);\n      }\n    }, 200);\n  }\n\n  function onInput(e) {\n    //on:input is thrown before the inner text of the input is updated.\n    // The following if-else ensure the text we search with is up-to-date\n    if (e.data) {\n      newTagText += e.data;\n    } else {\n      newTagText = newTagText.substring(0, newTagText.length - 1);\n    }\n    updateTags();\n    e.preventDefault();\n  }\n  updateTags();\n</script>\n\n<div class=\"tagHolder\" on:focusin={() => (focused = true)} on:focusout={() => (focused = false)}>\n  {#if !editable}\n    {#if tags.length > 0}\n      <div class=\"flex flex-row flex-wrap text-sm gap-1\">\n        {#each tags as tag}\n          <div class=\"text-neutral-300 lowercase\">\n            <span class=\"text-orange-500\">#</span>{tag.name}\n          </div>\n        {/each}\n      </div>\n    {/if}\n  {:else}\n    <Textfield class=\"tags\" bind:input={inputA} style=\"z-index: 9999\">\n      <FloatingLabel\n        class=\"pb-2\"\n        for=\"input-manual-a\"\n        slot=\"label\"\n        floatAbove={(newTag && newTag.value.length > 0) || focused || tags.length > 0}>\n        Tags\n      </FloatingLabel>\n      <div class=\"flex flex-row flex-wrap text-sm gap-1 mr-2\">\n        {#each tags as tag}\n          <div class=\"text-neutral-300 flex removable-tag\">\n            <span class=\"hashtag text-orange-500\">#</span>\n            <span class=\"cancel\">\n              <i class=\"material-icons mdc-chip__icon mdc-chip__icon--trailing\" on:click={() => deleteTag(tag)}\n                >cancel</i>\n            </span>\n            <p>{tag.name}</p>\n          </div>\n        {/each}\n      </div>\n      <div\n        id=\"newTagContainer\"\n        class=\"text-neutral-300 flex\"\n        bind:this={newTagContainer}\n        on:focusin={() => surface.setOpen(true)}\n        on:focusout={onFocusLost}>\n        <Input\n          id=\"input-manual-a\"\n          spellcheck=\"false\"\n          autocomplete=\"off\"\n          class=\"addTag inline text-sm text-neutral-300 {shake ? 'shake' : ''}\"\n          style=\"height: initial\"\n          bind:this={inputA}\n          bind:value={newTagText}\n          on:input={onInput} />\n      </div>\n    </Textfield>\n    <MenuSurface bind:this={surface} managed={true} anchorCorner=\"BOTTOM_LEFT\" anchorElement={newTag}>\n      <div style=\"margin: 1rem\">\n        <h1>Available Tags</h1>\n        {#if filteredTagsMatched.length > 0}\n          <div class=\"flex flex-nowrap m-1\">\n            <Set chips={filteredTagsMatched} let:chip key={(tag) => tag.name}>\n              <Chip {chip} on:SMUIChip:interaction={() => addTag(chip.name)}>\n                <Text>{chip.name}</Text>\n              </Chip>\n            </Set>\n          </div>\n        {/if}\n        {#if filteredTagsUnmatched.length > 0}\n          <div class=\"flex flex-nowrap m-1\">\n            <Set class=\"unmatched-tag\" chips={filteredTagsUnmatched} let:chip key={(tag) => tag.name}>\n              <Chip {chip} on:SMUIChip:interaction={() => addTag(chip.name)}>\n                <Text>{chip.name}</Text>\n              </Chip>\n            </Set>\n          </div>\n        {/if}\n      </div>\n    </MenuSurface>\n  {/if}\n</div>\n\n<style lang=\"scss\">\n  .removable-tag {\n    .cancel {\n      display: none;\n      cursor: pointer;\n\n      i {\n        padding: 0;\n        margin: 0;\n      }\n    }\n\n    &:hover {\n      .hashtag {\n        display: none;\n      }\n\n      .cancel {\n        display: initial;\n      }\n    }\n  }\n\n  :global(.tags) {\n    overflow-y: visible;\n  }\n\n  .tagHolder {\n    min-width: 100px;\n    max-width: 400px;\n    overflow-y: visible;\n\n    /* width */\n    ::-webkit-scrollbar {\n      width: 10px;\n    }\n\n    /* Track */\n    ::-webkit-scrollbar-track {\n      background: #f1f1f1;\n    }\n\n    /* Handle */\n    ::-webkit-scrollbar-thumb {\n      background: #888;\n    }\n\n    /* Handle on hover */\n    ::-webkit-scrollbar-thumb:hover {\n      background: #555;\n    }\n  }\n</style>\n"],"names":["ctx","length","create_if_block_1","t4_value","name","insert_hydration","target","div","anchor","append_hydration","span0","span1","i","p","dirty","set_data","t4","div0","div1","floatAbove","value","floatinglabel_changes","t_value","t","create_if_block_3","create_if_block_2","h1","t1_value","span","t1","tag","getAllTags","operationStore","GetTagsDocument","tags","$$props","editable","inputA","allTags","filteredTagsMatched","filteredTagsUnmatched","newTagText","newTag","newTagContainer","surface","focused","tagList","currentTags","filterText","console","log","toLowerCase","unfiltered","filter","find","id","filtered","includes","findIndex","filterAvailableTags","$$invalidate","query","subscribe","fetching","error","data","getTags","updateTags","newTagObj","tagToAdd","push","v","setTimeout","contains","document","activeElement","setOpen","e","substring","preventDefault","click_handler","deleteTag","$$value","addTag","chip","focusin_handler_1","focusout_handler","getElement"],"mappings":"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"}